<!DOCTYPE html>
<html>
	<head>
		<title>Flygande Toalett IRC</title>
		<meta charset="utf-8">
		<style>
			body{
				background-color:#F3EEE1;
			}

			#title{
				font-size:200%;
				font-weight:bold;
			}

			.connection .status .connected{
				color:gray;
				font-size:80%;
			}

			.connection .input,
			.connection .input .message{
				width:100%;
			}

			.connection .messages{
				width:100%;
				height:100%;
				overflow:auto;
				white-space:pre-wrap;
			}

			.connection .messages,
			#messageInput{
				font-family:"Courier New","monospace";
				font-size:14px;
			}

			.connection .messages .message .time{
				display:inline;
				color:gray;
				margin-right:1ex;
			}

			.connection .messages .message .time:before{
				content:"[";
			}

			.connection .messages .message .time:after{
				content:"]";
			}

			.connection .messages .message .text{
				display:inline;
			}

			.connection .messages .message .title{
				display:inline;
				font-weight:bold;
				margin-right:1ex;
			}

			.connection .messages .message .title:after{
				content:":";
			}

			.connection{
				display:table;
				position:absolute;
				left:0;
				right:0;
				bottom:0;
				width:100%;
				height:100%;
				padding-top:64px;
			}

			.connection form{
				display:table-row;
			}

			.connection:first-child{
				height:100%
			}

			.connection .senderButtons .messageSend{
				width:100%;
			}
		</style>
		<script type="text/javascript" src="onload.js"></script>
		<script type="text/javascript">
			function zeroPad(str,len){
				str=str.toString();
				var repeat=len-str.length;
				if(repeat>0)
					return Array(repeat+1).join("0")+str;
				else
					return str;
			}

			window.onload = function(){
				window.WebSocket = window.WebSocket || window.MozWebSocket;

				var websocket = new WebSocket('ws://127.0.0.1:1569','flygandetoalett-irc');
				websocket.connectionElem = document.getElementsByClassName('connection')[0];
				websocket.connectionElem.getElementsByClassName('connected')[0].innerHTML='Connecting';

				//"Connecting" text dots
				var dotIncrement=setInterval(function(){
					if(websocket.readyState==0){
						websocket.connectionElem.getElementsByClassName('connected')[0].innerHTML+='.';
					}else
						clearInterval(dotIncrement);
				},1000);

				websocket.onopen = function(){
					this.connectionElem.getElementsByClassName('connected')[0].innerHTML='Connected to server';
					this.connectionElem.getElementsByTagName("INPUT").disabled=false;
				};

				websocket.onerror = function(){
					this.connectionElem.getElementsByClassName('connected')[0].innerHTML='Not connected to server';
					this.connectionElem.getElementsByTagName("INPUT").disabled=false;
				};

				websocket.onmessage = function(message){
					var now = new Date();
					//Message container
					var messagesElem = this.connectionElem.getElementsByClassName('messages')[0];
					//New message
					var messageElem  = document.createElement('div');
						//Time
						var messageTimeElem = document.createElement('div');
							messageTimeElem.className = 'time';
							messageTimeElem.innerHTML = zeroPad(now.getHours(),2)+":"+zeroPad(now.getMinutes(),2)+":"+zeroPad(now.getSeconds(),2);
						messageElem.appendElement(messageTimeElem);
						
						//Text
						var messageTextElem = document.createElement('div');
							messageTextElem.innerHTML = message.data;
						messageElem.appendElement(messageTextElem);
					messagesElem.appendChild(messageElem);

					//Scroll to bottom
					messagesElem.scrollTop=elem.scrollHeight;
				};
			};
		</script>
		</head>
	<body>
		<div id="title">IRC Chat</div>
		<table class="connection">
			<tr class="status">
				<div class="connected">Not connecting</div>
			</tr>
			<tr>
				<div class="messages"></div>
			</tr>
			<form target="#">
				<td class="input">
					<input type="text" class="message" disabled maxlength="512" autofocus autocomplete="off" />
				</td>
				<td class="senderButtons">
					<input type=submit class="messageSend" disabled value="Send" />
					<button class="nickChange" disabled>Nickname</button>
				</td>
			</form>
		</table>
	</body>
</html>
